## v24.1.0-alpha.6

Release Date: April 15, 2024

{% include releases/release-downloads-docker-image.md release=include.release %}

<h3 id="v24-1-0-alpha-6-general-changes">General changes</h3>

- The following [metrics]({% link v24.1/metrics.md %}) were added for observability into the source of disk writes:
    - `storage.category-pebble-wal.bytes-written`
    - `storage.category-pebble-compaction.bytes-written`
    - `storage.category-pebble-ingestion.bytes-written`
    - `storage.category-pebble-memtable-flush.bytes-written`
    - `storage.category-raft-snapshot.bytes-written`
    - `storage.category-encryption-registry.bytes-written`
    - `storage.category-crdb-log.bytes-written`
    - `storage.category-sql-row-spill.bytes-written`
    - `storage.category-sql-col-spill.bytes-written`
    - `storage.category-unspecified.bytes-written`
[#119024][#119024]

<h3 id="v24-1-0-alpha-6-sql-language-changes">SQL language changes</h3>

- [`SHOW JOBS`]({% link v24.1/show-jobs.md %}) no longer displays some internal retry counter columns (`last_run`, `next_run`, `num_runs`) and now only shows the `statement`, `trace_id` and `execution_errors` columns when inspecting a specific job ID or IDs. [#121272][#121272]
- [`SHOW JOBS`]({% link v24.1/show-jobs.md %}) now shortens long job descriptions to 100 characters to make the table easier to read while the full description and statement can be inspected using `SHOW JOB` or `SHOW JOBS` on specific job IDs. [#121272][#121272]
- Extended [`pg_depend`]({% link v24.1/pg-catalog.md %}) to include dependencies between UDFs. [#121219][#121219]
- With [`sql_safe_updates`]({% link v24.1/session-variables.md %}) set to `true`, [`SELECT FOR UPDATE` and `SELECT FOR SHARE`]({% link v24.1/select-for-update.md %}) statements now return an error if they do not contain either a `WHERE` clause or a `LIMIT` clause.  Also, `UPDATE` and `DELETE` statements without `WHERE` clauses but with `LIMIT` clauses now bypass `sql_safe_updates`, which better matches MySQL behavior. [#121403][#121403]
- Added support for [PL/pgSQL]({% link v24.1/plpgsql.md %}) `CALL` statements. It is now possible to call a stored procedure from a PL/pgSQL routine. [#121319][#121319]
- `DEFAULT` expressions for input parameters of [user-defined functions]({% link v24.1/user-defined-functions.md %}) and stored procedures are now supported. [#121082][#121082]
- Default schema privilege changes will now be reflected and can be monitored in the [`pg_default_acl`]({% link v24.1/pg-catalog.md %}) table. [#121506][#121506]
- The schema of the [`pg_catalog.pg_proc`]({% link v24.1/pg-catalog.md %}) virtual table now matches `pg_proc` in PostgreSQL versions 14â€“16. This update includes the following changes:
    - `proisagg` and `proiswindow` columns are removed (done in v11).
    - `protransform` column is removed (done in v12).
    - `prosqlbody` column is added (done in v14).
    - `prosupport` and `prokind` columns are moved into their correct spot (these were incorrectly present in the end of the columns list).
    [#121966][#121966]

<h3 id="v24-1-0-alpha-6-command-line-changes">Command-line changes</h3>

- The [`--enterprise-encryption`]({% link v24.1/encryption.md %}#starting-a-node-with-encryption) flag now accepts the special value `path=*` to apply the specified keys to all stores. [#121111][#121111]

<h3 id="v24-1-0-alpha-6-db-console-changes">DB Console changes</h3>

- The **Commit Latency** chart in the [**Changefeeds** dashboard]({% link v24.1/ui-cdc-dashboard.md %}) now aggregates by max instead of by sum for multi-node [changefeeds]({% link v24.1/change-data-capture-overview.md %}). This more accurately reflects the amount of time for events to be acknowledged by the downstream sink. [#120787][#120787]
- Introduced a license expiration message to the [DB Console]({% link v24.1/ui-overview.md %}) in the top-right corner of the primary header. This message indicates the remaining days before license expiration for clusters with an {{ site.data.products.enterprise }} or trial license. [#120830][#120830]
- The [**Jobs** table]({% link v24.1/ui-jobs-page.md %}#jobs-table) page no longer includes two columns related to a deprecated internal implementation detail (last execution time and execution count). [#121269][#121269]
- The [**Goroutine Scheduling Latency**]({% link v24.1/ui-overload-dashboard.md %}#goroutine-scheduling-latency-99th-percentile) graph has been added to the **Runtime** page in the Metrics dashboards. [#121369][#121369]
- Updated the time format with milliseconds to use `.` (dot) as separation between seconds and milliseconds, which affects many pages in the [DB Console]({% link v24.1/ui-overview.md %}). [#121456][#121456]
- The [**Storage** dashboard]({% link v24.1/ui-storage-dashboard.md %}) now contains a graph categorizing disk writes that contribute to `sys.host.disk.write.bytes` according to the source of the write (WAL, compactions, SSTable ingestion, memtable flushes, Raft snapshots, encryption registry, logs, SQL columnar spill, or SQL row spill). [#119024][#119024]
- The timeseries graphs shown on the [**SQL Activity**]({% link v24.1/ui-overview.md %}#sql-activity) statement details page in the DB Console will now render properly, after fixing a bug related to setting the time range of the charts. [#121366][#121366]
- [Index recommendations]({% link v24.1/ui-databases-page.md %}#index-recommendations) in the DB Console will now function properly for indexes on tables or columns whose names contain quotation marks or whitespace. For example: `CREATE INDEX ON "my table" ("my col");`. [#121731][#121731]

<h3 id="v24-1-0-alpha-6-bug-fixes">Bug fixes</h3>

- Sequence options for `NO MINVALUE` and `NO MAXVALUE` now match PostgreSQL behavior. Sequence `MINVALUE` and `MAXVALUE` automatically adjust to new types bounds mirroring behavior of PostgreSQL. [#120984][#120984]
- Fixed a bug where `UPDATE` and `UPSERT` queries with a subquery were sometimes inappropriately using [implicit `FOR UPDATE` locking]({% link v24.1/selection-queries.md %}#row-level-locking-for-concurrency-control-with-select-for-update) within the subquery. This bug had existed since implicit `FOR UPDATE` locking was introduced in v20.1.0. [#121333][#121333]
- CockroachDB could previously "leak" reported memory usage as accounted by the internal memory accounting system, the limit for which is configured with the `--max-sql-memory` flag, on long-running sessions that issue many (hundreds of thousands or more) transactions. This, in turn, could result in `"root: memory budget exceeded"` errors for other queries. This bug was present in versions v23.1.17 and v23.2.3 and is now fixed. [#121847][#121847]
- CockroachDB could previously incorrectly evaluate `IN` expressions that had `INT2` or `INT4` type on the left side and values outside of the range of the left side on the right side. The bug has been present since at least v21.1 and is now fixed. [#121904][#121904]
- Fixed a slow memory leak in the deprecated [Pub/Sub changefeeds]({% link v24.1/changefeed-sinks.md %}), which can accumulate when restarting or canceling many deprecated Pub/Sub changefeeds. The bug had been present since the deprecated Pub/Sub changefeed was introduced in a testing release of v22.1. [#121817][#121817]

<div class="release-note-contributors" markdown="1">

<h3 id="v24-1-0-alpha-6-contributors">Contributors</h3>

This release includes 202 merged PRs by 49 authors.

</div>

[#119024]: https://github.com/cockroachdb/cockroach/pull/119024
[#120787]: https://github.com/cockroachdb/cockroach/pull/120787
[#120830]: https://github.com/cockroachdb/cockroach/pull/120830
[#120984]: https://github.com/cockroachdb/cockroach/pull/120984
[#121082]: https://github.com/cockroachdb/cockroach/pull/121082
[#121111]: https://github.com/cockroachdb/cockroach/pull/121111
[#121219]: https://github.com/cockroachdb/cockroach/pull/121219
[#121269]: https://github.com/cockroachdb/cockroach/pull/121269
[#121272]: https://github.com/cockroachdb/cockroach/pull/121272
[#121319]: https://github.com/cockroachdb/cockroach/pull/121319
[#121333]: https://github.com/cockroachdb/cockroach/pull/121333
[#121366]: https://github.com/cockroachdb/cockroach/pull/121366
[#121369]: https://github.com/cockroachdb/cockroach/pull/121369
[#121403]: https://github.com/cockroachdb/cockroach/pull/121403
[#121456]: https://github.com/cockroachdb/cockroach/pull/121456
[#121506]: https://github.com/cockroachdb/cockroach/pull/121506
[#121609]: https://github.com/cockroachdb/cockroach/pull/121609
[#121731]: https://github.com/cockroachdb/cockroach/pull/121731
[#121817]: https://github.com/cockroachdb/cockroach/pull/121817
[#121847]: https://github.com/cockroachdb/cockroach/pull/121847
[#121904]: https://github.com/cockroachdb/cockroach/pull/121904
[#121966]: https://github.com/cockroachdb/cockroach/pull/121966
[#122045]: https://github.com/cockroachdb/cockroach/pull/122045
