## v24.1.0-alpha.6

Release Date: April 15, 2024

{% include releases/release-downloads-docker-image.md release=include.release %}

<h3 id="v24-1-0-alpha-6-general-changes">General changes</h3>

- The following metrics were added for observability into the source of disk writes: - storage.category-pebble-wal.bytes-written - storage.category-pebble-compaction.bytes-written - storage.category-pebble-ingestion.bytes-written - storage.category-pebble-memtable-flush.bytes-written - storage.category-raft-snapshot.bytes-written - storage.category-encryption-registry.bytes-written - storage.category-crdb-log.bytes-written - storage.category-sql-row-spill.bytes-written - storage.category-sql-col-spill.bytes-written - storage.category-unspecified.bytes-written [#119024][#119024]

<h3 id="v24-1-0-alpha-6-sql-language-changes">SQL language changes</h3>

- SHOW JOBS no longer shows some internal retry counter columns (`last_run`, `next_run`, `num_runs`) and now only shows the `statement`, 'trace_id` and `execution_errors` columns when inspecting a specific job ID or IDs.  Epic: none. [#121272][#121272]
- SHOW JOBS now shortens long job descriptions to 100 characters to make the table easier to read while the full description and statement can be inspected using SHOW JOB or SHOW JOBS on specific Job IDs. Epic: none. [#121272][#121272]
- Extend pg_depend to include dependencies between UDFs. [#121219][#121219]
- With sql_safe_updates set to true, SELECT FOR UPDATE and SELECT FOR SHARE statements now return an error if they do not contain either a WHERE clause or LIMIT clause.  Also, UPDATE and DELETE statements without WHERE clauses but with LIMIT clauses now bypass sql_safe_updates, which better matches MySQL behavior. [#121403][#121403]
- Added support for PL/pgSQL CALL statements. It is now possible to call a stored procedure from a PL/pgSQL routine. [#121319][#121319]
- DEFAULT expressions for input parameters of user-defined functions and stored procedures are now supported. [#121082][#121082]
- Default schema privilege changes will now be reflected and can be monitored in the pg_default_acl table [#121506][#121506]
- Previously, we added support for settings reegion on the system database, which was limited to tenants only. We lifted this limitation to allow ALTER DATABASE PRIMARY REGION to work on system tenants. To support preview status, we created a cluster setting called sql.multiregion.preview_multiregion_system_database that will give users the option to set up their system database as multi-region for Cockroach dedicated (this cluster setting is not enabled by default). Note that after adding non-primary regions, we recommend that users do a rolling restart to propogate region information. [#121293][#121293]
- The schema of `pg_catalog.pg_proc` virtual table now matches exactly that of Postgres of versions 14 through 16. The following changes are applied: - `proisagg` and `proiswindow` columns are removed (done in V11) - `protransform` column is removed (done in V12) - `prosqlbody` column is added (done in V14) - `prosupport` and `prokind` columns are moved into their correct spot (these were incorrectly present in the end of the columns list). [#121966][#121966]

<h3 id="v24-1-0-alpha-6-command-line-changes">Command-line changes</h3>

- The `--enterprise-encryption` flag now accepts the special value `path=*` to apply the specified keys to all stores. [#121111][#121111]

<h3 id="v24-1-0-alpha-6-db-console-changes">DB Console changes</h3>

- The "Commit Latency" chart in the changefeed dashboard now aggregates by max instead of by sum for multi-node changefeeds. This more accurately reflects the amount of time for events to be acknowledged by the downstream sink. [#120787][#120787]
- Show license expiration message in Db Console (top right corner in primary header) that indicates remaining days before license expires for clusters with enterprise or trial license. [#120830][#120830]
- The jobs table page no longer includes two columns related to a deprecated internal implementation detail (last execution time and execution count).  Epic: none. [#121269][#121269]
- The "Goroutine Scheduling Latency" graph has been added to the Runtime page in Metrics. [#121369][#121369]
- Time format with milliseconds uses `.` (dot) as separation between seconds and milliseconds. Affects many pages in Db Console. [#121456][#121456]
- The Storage metrics dashboard now contains a graph categorizing disk writes that contribute to `sys.host.disk.write.bytes` according to the source of the write (WAL, compactions, sstable ingestion, memtable flushes, raft snapshots, encryption registry, logs, SQL columnar spill, or SQL row spill). [#119024][#119024]

<h3 id="v24-1-0-alpha-6-bug-fixes">Bug fixes</h3>

- Sequence options for 'NO MINVALUE' and 'NO MAXVALUE' now replicate postgreSQL.  Sequence MINVALUE and MAXVALUE automatical adjust to new types bounds mirroring behavior of postgreSQL. [#120984][#120984]
- The timeseries graphs shown on the SQL Activity statement details page in DB Console will now render properly, after fixing a bug related to setting the time range of the charts. [#121366][#121366]
- Fix a bug where UPDATE and UPSERT queries with a subquery were sometimes inappropriately using implicit FOR-UPDATE locking within the subquery. This bug has existing since implicit FOR-UPDATE locking was introduced in 20.1.0. [#121333][#121333]
- CockroachDB could previously "leak" reported memory usage (as accounted by the internal memory accounting system, the limit for which is configured via --max-sql-memory flag) on long-running sessions that issue many (hundreds of thousands or more) transactions. This, in turn, could result in "root: memory budget exceeded" errors for other queries. The bug is present in versions 23.1.17 and 23.2.3 and is now fixed. [#121847][#121847]
- CockroachDB could previously incorrectly evaluate IN expressions that had INT2 or INT4 type on the left side and values outside of the range of the left side on the right side. The bug has been present since at least 21.1 and is now fixed. [#121904][#121904]
- Index recommendations in the DB Console will now function properly for indexes on tables/columns whose names contain quotation marks and/or whitespace. For example: `CREATE INDEX ON "my table" ("my col");` [#121731][#121731]

<h3 id="v24-1-0-alpha-6-miscellaneous">Miscellaneous</h3>

<h4 id="v24-1-0-alpha-6-missing-category">Missing category</h4>

- Fixed a slow memory leak in deprecated pubsub changefeeds which can accumulate when restarting/cancelling many deprecated pubsub changefeeds. The bug had been there since the deprecated pubsub was introduced in 22.1 (beta). [#121817][#121817]

<h4 id="v24-1-0-alpha-6-changes-without-release-note-annotation">Changes without release note annotation</h4>

- [#122045][#122045] [19c8ee403][19c8ee403] roachtest: export grafana credentials for weekly roachtests (Darryl Wong <darryl.wong@cockroachlabs.com>)
- [#121609][#121609] [2c2e985fd][2c2e985fd] GNUmakefile: add .PHONY: all and help (imalasong <2879499479@qq.com>, xiaochangbai <704566072@qq.com>)
- [#121318][#121318] [179551a4d][179551a4d] sql: version gate create of new job type (Steven Danna <danna@cockroachlabs.com>)

<h3 id="v24-1-0-alpha-6-doc-updates">Doc updates</h3>

{% comment %}Docs team: Please add these manually.{% endcomment %}

<div class="release-note-contributors" markdown="1">

<h3 id="v24-1-0-alpha-6-contributors">Contributors</h3>

This release includes 202 merged PRs by 49 authors.
We would like to thank the following contributors from the CockroachDB community:

- Andrew Delph
- Bergin Dedej (first-time contributor)
- Darryl Wong (first-time contributor, CockroachDB team member)
- David Hartunian (first-time contributor, CockroachDB team member)
- Jasmine Sun (first-time contributor, CockroachDB team member)
- Linh Chu (first-time contributor, CockroachDB team member)
- Rachael Harding (first-time contributor, CockroachDB team member)
- Ryan Punt (first-time contributor, CockroachDB team member)
- Vidit Bhat (first-time contributor, CockroachDB team member)
- imalasong (first-time contributor)
- lyang24
- xiaochangbai (first-time contributor)

</div>

[#119024]: https://github.com/cockroachdb/cockroach/pull/119024
[#120787]: https://github.com/cockroachdb/cockroach/pull/120787
[#120830]: https://github.com/cockroachdb/cockroach/pull/120830
[#120984]: https://github.com/cockroachdb/cockroach/pull/120984
[#121082]: https://github.com/cockroachdb/cockroach/pull/121082
[#121111]: https://github.com/cockroachdb/cockroach/pull/121111
[#121219]: https://github.com/cockroachdb/cockroach/pull/121219
[#121269]: https://github.com/cockroachdb/cockroach/pull/121269
[#121272]: https://github.com/cockroachdb/cockroach/pull/121272
[#121293]: https://github.com/cockroachdb/cockroach/pull/121293
[#121318]: https://github.com/cockroachdb/cockroach/pull/121318
[#121319]: https://github.com/cockroachdb/cockroach/pull/121319
[#121333]: https://github.com/cockroachdb/cockroach/pull/121333
[#121366]: https://github.com/cockroachdb/cockroach/pull/121366
[#121369]: https://github.com/cockroachdb/cockroach/pull/121369
[#121403]: https://github.com/cockroachdb/cockroach/pull/121403
[#121456]: https://github.com/cockroachdb/cockroach/pull/121456
[#121506]: https://github.com/cockroachdb/cockroach/pull/121506
[#121609]: https://github.com/cockroachdb/cockroach/pull/121609
[#121731]: https://github.com/cockroachdb/cockroach/pull/121731
[#121817]: https://github.com/cockroachdb/cockroach/pull/121817
[#121847]: https://github.com/cockroachdb/cockroach/pull/121847
[#121904]: https://github.com/cockroachdb/cockroach/pull/121904
[#121966]: https://github.com/cockroachdb/cockroach/pull/121966
[#122045]: https://github.com/cockroachdb/cockroach/pull/122045
[179551a4d]: https://github.com/cockroachdb/cockroach/commit/179551a4d
[19c8ee403]: https://github.com/cockroachdb/cockroach/commit/19c8ee403
[2c2e985fd]: https://github.com/cockroachdb/cockroach/commit/2c2e985fd
