## v24.1.0

Release Date: May 20, 2024

With the release of CockroachDB v24.1, we've added new capabilities to help you migrate, build, and operate more efficiently. Refer to our summary of the most significant user-facing changes under [Feature Highlights](#v24-1-0-feature-highlights).

{% include releases/new-release-downloads-docker-image.md release=include.release advisory_key="a103220"%}

<h3 id="v24-1-0-feature-highlights">Feature highlights</h3>

This section summarizes the most significant user-facing changes in v24.1.0 and other features recently made available to CockroachDB users across versions. For a complete list of features and changes in v24.1, including bug fixes and performance improvements, refer to the [release notes]({% link releases/index.md %}#testing-releases) for previous v24.1 testing releases. You can also search the docs for sections labeled [New in v24.1](https://www.cockroachlabs.com/docs/search?query=new+in+v24.1).

- **Feature categories**
    - [Observability](#v24-1-0-observability)
    - [Migrations](#v24-1-0-migrations)
    - [Security and compliance](#v24-1-0-security-and-compliance)
    - [Disaster recovery](#v24-1-0-disaster-recovery)
    - [Deployment and operations](#v24-1-0-deployment-and-operations)
    - [SQL](#v24-1-0-sql)
- **Additional information**
    - [Backward-incompatible changes](#v24-1-0-backward-incompatible-changes)
    - [Deprecations](#v24-1-0-deprecations)
    - [Known limitations](#v24-1-0-known-limitations)
    - [Additional resources](#v24-1-0-additional-resources)

{{ site.data.alerts.callout_info }}
In CockroachDB Self-Hosted, all available features are free to use unless their description specifies that an Enterprise license is required. For more information, refer to the [Licensing FAQ](https://www.cockroachlabs.com/docs/stable/licensing-faqs).
{{ site.data.alerts.end }}

<div id="feature-highlights">

<h4 id="v24-1-0-observability">Observability</h4>
<table>
    <thead>
        <tr>
            <th class="center-align" colspan="1" rowspan="2">Feature</th>
            <th class="center-align" colspan="4" rowspan="1">Availability</th>
        </tr>
        <tr>
            <th colspan="1" rowspan="1">Ver.</th>
            <th colspan="1" rowspan="1" style="white-space: nowrap;">Self-Hosted</th>
            <th colspan="1" rowspan="1">Dedicated</th>
            <th colspan="1" rowspan="1">Serverless</th>
        </tr>
    </thead>
    <tbody>
        <!-- Rows for each feature -->
        <tr>
            <td>
                <p class="feature-summary">TBD</p>
                <p class="feature-description">TBD</p>
            </td>
            <td>TBD</td>
            <td class="icon-center">{% include icon-yes.html %}</td>
            <td class="icon-center">{% include icon-yes.html %}</td>
            <td class="icon-center">{% include icon-no.html %}</td>
        </tr>
    </tbody>
</table>

<h4 id="v24-1-0-migrations">Migrations</h4>

<table>
    <thead>
        <tr>
            <th class="center-align" colspan="1" rowspan="2">Feature</th>
            <th class="center-align" colspan="4" rowspan="1">Availability</th>
        </tr>
        <tr>
            <th colspan="1" rowspan="1">Ver.</th>
            <th colspan="1" rowspan="1" style="white-space: nowrap;">Self-Hosted</th>
            <th colspan="1" rowspan="1">Dedicated</th>
            <th colspan="1" rowspan="1">Serverless</th>
        </tr>
    </thead>
    <tbody>
        <!-- Rows for each feature -->
        <tr>
            <td>
                <p class="feature-summary">TBD</p>
                <p class="feature-description">TBD</p>
            </td>
            <td>TBD</td>
            <td class="icon-center">{% include icon-yes.html %}</td>
            <td class="icon-center">{% include icon-yes.html %}</td>
            <td class="icon-center">{% include icon-yes.html %}</td>
        </tr>
    </tbody>
</table>

<h4 id="v24-1-0-disaster-recovery">Disaster recovery</h4>

<table>
    <thead>
        <tr>
            <th class="center-align" colspan="1" rowspan="2">Feature</th>
            <th class="center-align" colspan="4" rowspan="1">Availability</th>
        </tr>
        <tr>
            <th colspan="1" rowspan="1">Ver.</th>
            <th colspan="1" rowspan="1" style="white-space: nowrap;">Self-Hosted</th>
            <th colspan="1" rowspan="1">Dedicated</th>
            <th colspan="1" rowspan="1">Serverless</th>
        </tr>
    </thead>
    <tbody>
        <!-- Rows for each feature -->
        <tr>
        <td>
            <p class="feature-summary">TBD</p>
            <p class="feature-description">TBD.</p>
        </td>
        <td>TBD</td>
        <td class="icon-center">{% include icon-yes.html %}</td>
        <td class="icon-center">{% include icon-no.html %}</td>
        <td class="icon-center">{% include icon-no.html %}</td>
        </tr>
    </tbody>
</table>

<h4 id="v24-1-0-security-and-compliance">Security and compliance</h4>

<table>
    <thead>
        <tr>
            <th class="center-align" colspan="1" rowspan="2">Feature</th>
            <th class="center-align" colspan="4" rowspan="1">Availability</th>
        </tr>
        <tr>
            <th colspan="1" rowspan="1">Ver.</th>
            <th colspan="1" rowspan="1" style="white-space: nowrap;">Self-Hosted</th>
            <th colspan="1" rowspan="1">Dedicated</th>
            <th colspan="1" rowspan="1">Serverless</th>
        </tr>
    </thead>
    <tbody>
        <!-- Rows for each feature -->
        <tr>
        <td>
            <p class="feature-summary">TBD</p>
            <p class="feature-description">TBD</p>
        </td>
        <td>TBD</td>
        <td class="icon-center">{% include icon-no.html %}</td>
        <td class="icon-center">{% include icon-yes.html %}</td>
        <td class="icon-center">{% include icon-no.html %}</td>
        </tr>
    </tbody>
</table>

<h4 id="v24-1-0-deployment-and-operations">Deployment and operations</h4>

<table>
    <thead>
        <tr>
            <th class="center-align" colspan="1" rowspan="2">Feature</th>
            <th class="center-align" colspan="4" rowspan="1">Availability</th>
        </tr>
        <tr>
            <th colspan="1" rowspan="1">Ver.</th>
            <th colspan="1" rowspan="1" style="white-space: nowrap;">Self-Hosted</th>
            <th colspan="1" rowspan="1">Dedicated</th>
            <th colspan="1" rowspan="1">Serverless</th>
        </tr>
    </thead>
    <tbody>
        <!-- Rows for each feature -->
        <tr>
        <td>
            <p class="feature-summary">TBD</p>
            <p class="feature-description">TBD</p>
        </td>
        <td>TBD</td>
        <td class="icon-center">{% include icon-no.html %}</td>
        <td class="icon-center">{% include icon-yes.html %}</td>
        <td class="icon-center">{% include icon-no.html %}</td>
        </tr>
    </tbody>
</table>

<h4 id="v24-1-0-sql">SQL</h4>

<table>
    <thead>
        <tr>
            <th class="center-align" colspan="1" rowspan="2">Feature</th>
            <th class="center-align" colspan="4" rowspan="1">Availability</th>
        </tr>
        <tr>
            <th colspan="1" rowspan="1">Ver.</th>
            <th colspan="1" rowspan="1" style="white-space: nowrap;">Self-Hosted</th>
            <th colspan="1" rowspan="1">Dedicated</th>
            <th colspan="1" rowspan="1">Serverless</th>
        </tr>
    </thead>
    <tbody>
        <!-- Rows for each feature -->
        <tr>
        <td>
            <p class="feature-summary">TBD</p>
            <p class="feature-description">TBD</p>
        </td>
        <td>TBD</td>
        <td class="icon-center">{% include icon-no.html %}</td>
        <td class="icon-center">{% include icon-yes.html %}</td>
        <td class="icon-center">{% include icon-no.html %}</td>
        </tr>
    </tbody>
</table>

<table>
    <thead>
        <tr>
            <th id="feature-detail-key" colspan="2">Feature detail key</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>*</td>
            <td>Features marked “All*” were recently made available in the CockroachDB Cloud platform. They are available for all supported versions of CockroachDB, under the deployment methods specified in their row under Availability.</td>
        </tr>
        <tr>
            <td>**</td>
            <td>Features marked “All**” were recently made available via migration tools maintained outside of the CockroachDB binary. They are available to use with all supported versions of CockroachDB, under the deployment methods specified in their row under Availability.</td>
        </tr>
        <tr>
            <td>{% include icon-yes.html %}</td>
            <td>Feature is available for this deployment method of CockroachDB as specified in the icon’s column: CockroachDB Self-Hosted, CockroachDB Dedicated, or CockroachDB Serverless.</td>
        </tr>
        <tr>
            <td>{% include icon-no.html %}</td>
            <td>Feature is not available for this deployment method of CockroachDB as specified in the icon’s column: CockroachDB Self-Hosted, CockroachDB Dedicated, or CockroachDB Serverless.</td>
        </tr>
    </tbody>
</table>


</div>

<h4 id="v24-1-0-backward-incompatible-changes">Backward-incompatible changes</h4>

Before [upgrading to CockroachDB v24.1]({% link v24.1/upgrade-cockroach-version.md %}), be sure to review the following backward-incompatible changes, as well as [key cluster setting changes](#v24-1-0-cluster-settings), and adjust your deployment as necessary.

- TBD

<h4 id="v24-1-0-cluster-settings">Key Cluster Setting Changes</h4>

The following changes should be reviewed prior to upgrading. Default cluster settings will be used unless you have manually set a value for a setting. This can be confirmed by checking the `system.settings` table (`select * from system.settings`) to view the non-default settings.

- `changefeed.balance_range_distribution.enable` is now deprecated. Instead, use the new [cluster setting]({% link v23.2/cluster-settings.md %}) `changefeed.default_range_distribution_strategy`. `changefeed.default_range_distribution_strategy='balanced_simple'` has the same effect as setting `changefeed.balance_range_distribution.enable=true`. It does not require `initial_scan='only'`, which was required by the old setting. [#115166][#115166]
- Added the [cluster setting]({% link v24.1/cluster-settings.md %}) `security.client_cert.subject_required.enabled` that enforces a mandatory requirement for the client certificate's role subject to be set. The subject can be defined through either the subject role option or by specifying the `root-cert-distinguished-name` and `node-cert-distinguished-name` properties. This setting applies to both RPC access and login via authCert. [#122368][#122368]
- The [cluster setting]({% link v23.2/cluster-settings.md %}) `sql.contention.record_serialization_conflicts.enabled` is now `on` by default. This means any [`40001` errors]({% link v23.2/transaction-retry-error-reference.md %}) that are returned containing conflicting transaction information will be recorded by the contention registry, improving the ability to troubleshoot. For more information, refer to the [Insights page]({% link v24.1/ui-insights-page.md %}) documentation. [#116664][#116664]
- The new [cluster setting]({% link v24.1/cluster-settings.md %}) `storage.sstable.compression_algorithm` configures the compression algorithm used when compressing sstable blocks. Supported values are: "snappy" and "zstd" [snappy = `1`, zstd = `2`]. Changing the default of snappy to zstd can result in substantial performance improvement, however, the effects this change may be highly dependent on the workload and data, so experimentation is recommended before enabling zstd in production environments.
- The new setting `storage.wal_failover.unhealthy_op_threshold` allows you to set the latency threshold at which a WAL (Write-Ahead Logging) write is considered unhealthy. When exceeded, the node will attempt to write WAL entries to a secondary store's volume. For more information, refer to <v24.1/cockroach-start.md#write-ahead-log-wal-failover> [#120509][#120509]
- Added the `server.max_open_transactions_per_gateway` [cluster setting]({% link v23.2/cluster-settings.md %}). When set to a non-negative value, non-`admin` users cannot execute a query if the number of transactions open on the current gateway node is already at the configured limit. [#118781][#118781]
- Introduced the `server.redact_sensitive_settings.enabled` [cluster setting](https://www.cockroachlabs.com/docs/v23.2/cluster-settings), which is false by default. If set to `true`, then the values of the following settings will be redacted when accessed through `SHOW` commands or other introspection interfaces. In the future, any other sensitive cluster settings that are added will be redacted as well. Users who have the `MODIFYCLUSTERSETTING` [privilege](https://www.cockroachlabs.com/docs/v23.2/security-reference/authorization#managing-privileges) can always view the unredacted settings. [#117729][#117729]
    - `server.oidc_authentication.client_id`
    - `server.oidc_authentication.client_secret`
- The new boolean changefeed option [`ignore_disable_changefeed_replication`](../v24.1/create-changefeed.html#ignore-disable-changefeed), when set to `true`, prevents the changefeed from filtering events even if CDC filtering is configured via the `disable_changefeed_replication` [session variable](../v24.1/session-variables.html), `sql.ttl.changefeed_replication.disabled` [cluster setting](../v24.1/cluster-settings.html), or the `ttl_disable_changefeed_replication` [table storage parameter](../v24.1/alter-table.html#table-storage-parameters). [#120255][#120255]
- kvadmission.store.provisioned_bandwidth - Release note (ops change): The provisioned-rate field, if specified,
should no longer accept a disk-name or an optional bandwidth field. To
use the disk bandwidth constraint the store-spec must contain
provisioned-rate=bandwidth=<bandwidth-bytes/s>, otherwise the cluster
setting kv.store.admission.provisioned_bandwidth will be used.
  - TODO: Confirm that cluster setting is erroneously referencing its old name. Inquired with Eng.
  - Setting desc: If set to a non-zero value, this is used as the provisioned bandwidth (in bytes/s), for each store. It can be overridden on a per-store basis using the --store flag. Note that setting the provisioned bandwidth to a positive value may enable disk bandwidth based admission control, since admission.disk_bandwidth_tokens.elastic.enabled defaults to true.
- Add sql.txn.read_committed_isolation.enabled
- Add sql.show_ranges_deprecated_behavior.enabled
- Add sql.trace.session_eventlog.enabled
- Add changefeed.balance_range_distribution.enabled

<h4 id="v24-1-0-deprecations">Deprecations</h4>

{% comment %}TODO: Intro para? Each sibling section has one.{% endcomment %}

- TBD

<h4 id="v24-1-0-known-limitations">Known limitations</h4>

For information about new and unresolved limitations in CockroachDB v24.1, with suggested workarounds where applicable, refer to [Known Limitations](https://www.cockroachlabs.com/docs/v24.1/known-limitations).

<h4 id="v24-1-0-additional-resources">Additional resources</h4>

Resource             | Topic                                      | Description
---------------------+--------------------------------------------+-------------
Cockroach University | [Example link](https://example.com/course1)| Summary here
Cockroach University | [Example link](https://example.com/course2)| Summary here
Docs                 | [Example link](https://example.com/doc1)   | Summary here
Docs                 | [Example link](https://example.com/doc2)   | Summary here
